cmake_minimum_required(VERSION 3.1)
find_package(Threads)

set({0}_TEST_DEPENDENCIES {1} ${GTEST_BOTH_LIBRARIES} ${GMOCK_BOTH_LIBRARIES})
set({0}_CUCUMBERTEST_TEST_DEPENDENCIES ${CUCUMBER_BINARIES} ${{0}_TEST_DEPENDENCIES})

macro(ADD_NEW_TEST TEST_SOURCE FOLDER_NAME)
	set (TARGET_NAME ${TEST_SOURCE}_TESTTARGET)
	add_executable(${TARGET_NAME} ${TEST_SOURCE}.cxx)
	target_link_libraries(${TARGET_NAME} ${{0}_TEST_DEPENDENCIES} )
	add_test(NAME ${TEST_SOURCE} COMMAND ${TARGET_NAME})
	set_property(TARGET ${TARGET_NAME} PROPERTY FOLDER ${FOLDER_NAME})
endmacro()

macro(ADD_NEW_CUCUMBER_TEST TEST_SOURCE FOLDER_NAME)
	set (TARGET_NAME ${TEST_SOURCE}_TESTTARGET)
	add_executable(${TARGET_NAME} ${CMAKE_SOURCE_DIR}/features/step_definitions/${TEST_SOURCE})
	target_link_libraries(${TARGET_NAME} ${{0}_CUCUMBER_TEST_DEPENDENCIES})
	add_test(NAME ${TEST_SOURCE} COMMAND ${TARGET_NAME})
	set_property(TARGET ${TARGET_NAME} PROPERTY FOLDER ${FOLDER_NAME})
endmacro()

# set(MATERIALS_FOLDER ${CMAKE_CURRENT_BINARY_DIR}/{1}_tests_materials/)
# file(COPY ${CMAKE_CURRENT_SOURCE_DIR}/materials/ DESTINATION ${MATERIALS_FOLDER})
# add_definitions(-DMATERIALS_FOLDER="${MATERIALS_FOLDER}")

#add tests like this:
# ADD_NEW_TEST({1}_add_test "{1}_tests")
#Â ADD_NEW_CUCUMBER_TEST({1}_add_test {1}_cucumber_tests")

set(TEST_NAMES {3})
FOREACH(TEST_NAME ${TEST_NAMES})
	ADD_NEW_TEST(${TEST_NAME} "{1}_tests")
ENDFOREACH()
